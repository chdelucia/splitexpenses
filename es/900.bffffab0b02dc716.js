"use strict";(self.webpackChunksplitexpenses=self.webpackChunksplitexpenses||[]).push([[900],{6900:(I,E,_)=>{_.r(E),_.d(E,{DebtsModule:()=>ee});var p=_(6895),T=_(284),e=_(4650),u=_(5861),v=_(1135),g=_(3905),D=_(2134),y=_(7024),A=_(9121);let h=(()=>{class o{constructor(t,n){this.userService=t,this.expensesService=n,this.debts=new Map,this.traceDebts=[],this.myPropertySubject=new v.X(new Map),this.debtList$=this.myPropertySubject.asObservable(),this.users$=this.userService.getUsers(),this.expenses$=this.expensesService.getIterableExpenses(),this.initialize()}initialize(){var t=this;return(0,u.Z)(function*(){let n=yield(0,g.z)(t.users$);if(!n)throw new Error("No users found");yield t.createStructure(n),yield t.calcDebt(),t.traceDebts=[],t.settleCrossAccountDebts(n),t.myPropertySubject.next(t.debts)})()}getTraceDebts(){return this.traceDebts}getDebts(){return this.debts}createStructure(t){var n=this;return(0,u.Z)(function*(){let i=new Map;t.forEach(l=>{let s=n.createDebtObj();t.forEach(c=>{if(c&&l.id!==c.id){let a=n.createIndividualDebtObj();s.debts.set(c.id,a)}}),i.set(l.id,s)}),n.debts=new Map([...n.debts,...i])})()}createDebtObj(){return{debts:new Map,totalIveBeenPaid:0,totalIPaid:0,totalIowe:0}}createIndividualDebtObj(){return{individualtotalIveBeenPaid:0,newDebt:0,RefDebtsIds:[]}}calcDebt(){var t=this;return(0,u.Z)(function*(){let n=yield(0,g.z)(t.expenses$);for(const i of n)t.updateExpenseDebt(i)})()}settleCrossAccountDebts(t){this.debts.forEach((n,i)=>{n.debts.forEach((l,s)=>{let c=l.newDebt;c>0&&new Map([...this.debts].filter(([d,b])=>d!==i&&d!==s)).forEach((d,b)=>{let S=d.debts.get(i)?.newDebt||0;if(S>0){let m=Math.min(c,S),x=this.debts.get(s)?.debts.get(b)?.newDebt||0;x>0&&S<x&&(m=Math.min(c,x)),this.traceOfAutoSettlement({debtorId:i,lenderId:s,intermediaryId:b,debtorDebt:c,intermediaryDebtToDebtor:S,lenderDebtToIntermediary:x,amount:m},t),d.debts.get(i).newDebt-=m,d.debts.get(s).newDebt+=m,n.debts.get(b).newDebt+=m,l.newDebt-=m,this.debts.get(s).debts.get(i).newDebt+=m,this.debts.get(s).debts.get(b).newDebt-=m,c=l.newDebt}})})})}traceOfAutoSettlement(t,n){const i=n.get(t.debtorId)?.name,l=n.get(t.lenderId)?.name,s=n.get(t.intermediaryId)?.name,{debtorDebt:c,intermediaryDebtToDebtor:a,lenderDebtToIntermediary:d}=t;t.debtorId=i,t.lenderId=l,t.intermediaryId=s,c>a&&d>a&&(t.debtorId=l,t.lenderId=s,t.intermediaryId=i,t.debtorDebt=d,t.lenderDebtToIntermediary=a,t.intermediaryDebtToDebtor=c),t.finalDebtorDebt=(0,D.pd)(t.debtorDebt-t.amount),t.finalLenderDebt=(0,D.pd)(Math.abs(t.lenderDebtToIntermediary-t.amount)),t.finalIntermediaryDebt=(0,D.pd)(t.intermediaryDebtToDebtor-t.amount),this.traceDebts.push(t)}updateExpenseDebt(t){this.updatePayerDebt(t);const{sharedBy:n}=t;n.forEach(i=>{this.updateDebtorDebt(i,t)}),this.calcDirectDebtsDiff()}updatePayerDebt(t){const{paidBy:n}=t,i=this.debts.get(n);if(!i)throw new Error(`El pagador con ID '${n}' no est\xe1 definido.`);i.totalIPaid=this.calcTotalAmountIpaid(n,t,i.totalIPaid)}updateDebtorDebt(t,n){const{paidBy:i}=n,l=this.debts.get(t);if(!l)throw new Error(`El deudor con ID ${t} no est\xe1 definido.`);l.totalIveBeenPaid=this.calcTotalAmountIhaveBeenPaid(t,n,l.totalIveBeenPaid);const s=l.debts.get(i);s&&(s.individualtotalIveBeenPaid=this.calcTotalAmountIhaveBeenPaid(t,n,s.individualtotalIveBeenPaid)),l.debts.get(i)?.RefDebtsIds.push(n)}calcDirectDebtsDiff(){this.debts.forEach((t,n)=>{t.totalIowe=0,t.debts.forEach((i,l)=>{let s=i.individualtotalIveBeenPaid,c=this.debts.get(l)?.debts.get(n)?.individualtotalIveBeenPaid||0;i.newDebt=(0,D.pd)(s-c),t.totalIowe=(0,D.pd)(t.totalIowe+i.newDebt)})})}calcTotalAmountIpaid(t,n,i){const l=n.sharedBy.includes(t);return(0,D.pd)(i+n.originalCost-(l?n.cost:0))}verifyTotalAmountIPaid(t){let n=0;return this.debts.forEach((i,l)=>{t!==l&&(n+=i.debts.get(t)?.individualtotalIveBeenPaid||0)}),n}calcTotalAmountIhaveBeenPaid(t,n,i){let s=i;return!n.settleBy.includes(t)&&(s+=n.cost),(0,D.pd)(s)}verifyTotalAmountIhaveBeenPaid(t){let n=0;return this.debts.get(t)?.debts.forEach(i=>{n+=i.individualtotalIveBeenPaid}),n}calcTotalAmountIAmOwed(t,n){return(0,D.pd)(t.totalIowe+n)}reset(){this.initialize()}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(y.f),e.LFG(A.r))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var F=_(3428);function C(o,r){if(1&o&&(e.TgZ(0,"div",14),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit,n=e.oxw();let i;e.xp6(1),e.AsE(" ",n.calcExchange(null==(i=n.debts.get(t.id))?null:i.totalIowe)," ",n.currency.currencyExchangeSymbol," ")}}function P(o,r){if(1&o&&(e.TgZ(0,"small",20),e._uU(1),e.qZA()),2&o){const t=e.oxw(3).$implicit,n=e.oxw().$implicit,i=e.oxw();let l,s;e.xp6(1),e.AsE(" ",i.calcExchange(null==(l=i.debts.get(n.id))||null==l.debts||null==(s=l.debts.get(t.id))?null:s.newDebt)," ",i.currency.currencyExchangeSymbol," ")}}function O(o,r){if(1&o&&(e.ynx(0),e._uU(1),e.ALo(2,"number"),e.YNc(3,P,2,2,"small",19),e.BQk()),2&o){const t=e.oxw(2).$implicit,n=e.oxw().$implicit,i=e.oxw();let l,s,c,a;e.xp6(1),e.AsE(" ",e.xi3(2,3,null==(l=i.debts.get(n.id))||null==l.debts||null==(s=l.debts.get(t.id))?null:s.newDebt,".0-2")," ",i.currency.currencySymbol," "),e.xp6(2),e.Q6J("ngIf",i.currency.active&&0!==(null==(c=i.debts.get(n.id))||null==c.debts||null==(a=c.debts.get(t.id))?null:a.newDebt))}}function M(o,r){if(1&o&&(e.TgZ(0,"small",20),e._uU(1),e.qZA()),2&o){const t=e.oxw(3).$implicit,n=e.oxw().$implicit,i=e.oxw();let l,s;e.xp6(1),e.AsE(" ",i.calcExchange(null==(l=i.debts.get(n.id))||null==l.debts||null==(s=l.debts.get(t.id))?null:s.individualtotalIveBeenPaid)," ",i.currency.currencyExchangeSymbol," ")}}function N(o,r){if(1&o&&(e._uU(0),e.YNc(1,M,2,2,"small",19)),2&o){const t=e.oxw(2).$implicit,n=e.oxw().$implicit,i=e.oxw();let l,s,c,a;e.AsE(" ",null==(l=i.debts.get(n.id))||null==l.debts||null==(s=l.debts.get(t.id))?null:s.individualtotalIveBeenPaid," ",i.currency.currencySymbol," "),e.xp6(1),e.Q6J("ngIf",i.currency.active&&0!==(null==(c=i.debts.get(n.id))||null==c.debts||null==(a=c.debts.get(t.id))?null:a.individualtotalIveBeenPaid))}}function $(o,r){if(1&o&&(e.TgZ(0,"div",16)(1,"div"),e._uU(2),e.qZA(),e.TgZ(3,"div"),e.YNc(4,O,4,6,"ng-container",17),e.YNc(5,N,2,3,"ng-template",null,18,e.W1O),e.qZA()()),2&o){const t=e.MAs(6),n=e.oxw().$implicit,i=e.oxw().$implicit,l=e.oxw();let s,c;e.xp6(2),e.Oqu(n.name),e.xp6(2),e.Q6J("ngIf",(null==(s=l.debts.get(i.id))||null==s.debts||null==(c=s.debts.get(n.id))?null:c.individualtotalIveBeenPaid)!=(null==(s=l.debts.get(i.id))||null==s.debts||null==(c=s.debts.get(n.id))?null:c.newDebt))("ngIfElse",t)}}function B(o,r){if(1&o&&(e.ynx(0),e.YNc(1,$,7,3,"div",15),e.BQk()),2&o){const t=r.$implicit,n=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",n.id!==t.id)}}function Z(o,r){if(1&o&&(e.TgZ(0,"div",7)(1,"div",8)(2,"div",9)(3,"div"),e._uU(4),e.TgZ(5,"span",10),e.SDv(6,11),e.qZA()(),e.TgZ(7,"div"),e._uU(8),e.YNc(9,C,2,2,"div",12),e.qZA()(),e.YNc(10,B,2,1,"ng-container",13),e.ALo(11,"async"),e.qZA()()),2&o){const t=r.$implicit,n=e.oxw();let i;e.xp6(1),e.MGl("routerLink","/debts/",t.id,""),e.xp6(3),e.hij("",t.name," "),e.xp6(4),e.AsE(" ",null==(i=n.debts.get(t.id))?null:i.totalIowe," ",n.currency.currencySymbol," "),e.xp6(1),e.Q6J("ngIf",n.currency.active),e.xp6(1),e.Q6J("ngForOf",e.lcZ(11,6,n.users$))}}function w(o,r){1&o&&(e.TgZ(0,"h2",21),e.SDv(1,22),e.qZA())}function L(o,r){if(1&o&&(e.TgZ(0,"section",23)(1,"div",24)(2,"h3",24),e.SDv(3,25),e.qZA(),e.TgZ(4,"div",26),e.tHW(5,27),e._UZ(6,"strong"),e.N_p(),e.qZA()(),e.TgZ(7,"div",28)(8,"div",29),e._uU(9),e.qZA(),e.TgZ(10,"div",30)(11,"div",31),e._uU(12),e.qZA(),e.TgZ(13,"div",32),e._uU(14),e.qZA(),e._UZ(15,"div",33),e.qZA(),e.TgZ(16,"div",34),e._uU(17),e.qZA()(),e.TgZ(18,"div",28)(19,"div",29),e._uU(20),e.qZA(),e.TgZ(21,"div",30)(22,"div",31),e._uU(23),e.qZA(),e.TgZ(24,"div",32),e._uU(25),e.qZA(),e._UZ(26,"div",33),e.qZA(),e.TgZ(27,"div",34),e._uU(28),e.qZA()(),e.TgZ(29,"div",28)(30,"div",29),e._uU(31),e.qZA(),e.TgZ(32,"div",30)(33,"div",31),e._uU(34),e.qZA(),e.TgZ(35,"div",32),e._uU(36),e.qZA(),e._UZ(37,"div",33),e.qZA(),e.TgZ(38,"div",34),e._uU(39),e.qZA()()()),2&o){const t=r.$implicit,n=r.index,i=e.oxw();e.xp6(3),e.pQV(n+1)(i.traceDebts.length),e.QtT(3),e.xp6(3),e.pQV(t.intermediaryId)(t.debtorId)(t.intermediaryDebtToDebtor)(i.currency.currencySymbol),e.QtT(5),e.xp6(3),e.Oqu(t.intermediaryId),e.xp6(3),e.AsE("",t.finalIntermediaryDebt,"",i.currency.currencySymbol,""),e.xp6(2),e.AsE("",t.intermediaryDebtToDebtor,"",i.currency.currencySymbol,""),e.xp6(3),e.Oqu(t.debtorId),e.xp6(3),e.Oqu(t.intermediaryId),e.xp6(3),e.AsE("",t.finalLenderDebt,"",i.currency.currencySymbol,""),e.xp6(2),e.AsE("",t.lenderDebtToIntermediary,"",i.currency.currencySymbol,""),e.xp6(3),e.Oqu(t.lenderId),e.xp6(3),e.Oqu(t.debtorId),e.xp6(3),e.AsE("",t.finalDebtorDebt,"",i.currency.currencySymbol,""),e.xp6(2),e.AsE("",t.debtorDebt,"",i.currency.currencySymbol,""),e.xp6(3),e.Oqu(t.lenderId)}}let R=(()=>{class o{constructor(t,n,i){this.debtsService=t,this.userService=n,this.currencyService=i,this.traceDebts=[],this.users$=this.userService.getIterableUsers(),this.currency=this.currencyService.getCurrencySettings(),this.debts=this.debtsService.getDebts()}ngOnInit(){this.DebtsSubscription=this.debtsService.debtList$.subscribe(t=>{this.debts=t,this.traceDebts=this.debtsService.getTraceDebts()})}calcExchange(t){return this.currencyService.calcExchangeValue(t||0)}ngOnDestroy(){this.DebtsSubscription?.unsubscribe()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(h),e.Y36(y.f),e.Y36(F.i))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-debts"]],decls:8,vars:5,consts:function(){let r,t,n,i,l;return r="Como saldar las Deudas",t="debe un total de:",n="Como se han calculado las deudas",i="Paso " + "\ufffd0\ufffd" + " de " + "\ufffd1\ufffd" + "",l=" " + "\ufffd0\ufffd" + " asume las deudas de " + "\ufffd1\ufffd" + " porque le debia " + "\ufffd#6\ufffd" + "" + "\ufffd2\ufffd" + "" + "\ufffd3\ufffd" + "" + "\ufffd/#6\ufffd" + "",[[1,"container-md","mb-5"],[1,"my-4","text-center"],r,[1,"row","g-4"],["class","col-sm-12 col-lg-6 col-xxl-4",4,"ngFor","ngForOf"],["class","my-5 text-center",4,"ngIf"],["class","g-4 row mt-4 card",4,"ngFor","ngForOf"],[1,"col-sm-12","col-lg-6","col-xxl-4"],[1,"persoanlDebts","p-md-3","p-2","algo2",3,"routerLink"],[1,"d-flex","flex-row","justify-content-between","title"],[1,"text"],t,["class","text-end mainExchange",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"text-end","mainExchange"],["class","d-flex flex-row justify-content-between align-items-center text-secondary py-1 subtitle",4,"ngIf"],[1,"d-flex","flex-row","justify-content-between","align-items-center","text-secondary","py-1","subtitle"],[4,"ngIf","ngIfElse"],["elseBlock",""],["class","text-end",4,"ngIf"],[1,"text-end"],[1,"my-5","text-center"],n,[1,"g-4","row","mt-4","card"],[1,"card-title"],i,[1,"card-description"],l,[1,"container"],[1,"item","first"],[1,"element"],[1,"current-debt"],[1,"old-debt"],[1,"triangle"],[1,"item","last"]]},template:function(t,n){1&t&&(e.TgZ(0,"main",0)(1,"h2",1),e.SDv(2,2),e.qZA(),e.TgZ(3,"section",3),e.YNc(4,Z,12,8,"div",4),e.ALo(5,"async"),e.qZA(),e.YNc(6,w,2,0,"h2",5),e.YNc(7,L,40,24,"section",6),e.qZA()),2&t&&(e.xp6(4),e.Q6J("ngForOf",e.lcZ(5,3,n.users$)),e.xp6(2),e.Q6J("ngIf",n.traceDebts.length),e.xp6(1),e.Q6J("ngForOf",n.traceDebts))},dependencies:[p.sg,p.O5,T.rH,p.Ov,p.JJ],styles:[".persoanlDebts[_ngcontent-%COMP%]{border:2px solid #1f2128;border-radius:7px;background:white;transition:all 1s ease}.persoanlDebts[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:1.5rem}.persoanlDebts[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-size:small}.persoanlDebts[_ngcontent-%COMP%]   .mainExchange[_ngcontent-%COMP%]{font-size:medium}.persoanlDebts[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-size:1rem}.persoanlDebts[_ngcontent-%COMP%]:hover, .persoanlDebts[_ngcontent-%COMP%]:active{transform:scale(1.05);border:1px solid;cursor:pointer}.list-group-item[_ngcontent-%COMP%]{display:flex;border:1px solid rgba(0,0,0,.125)}small[_ngcontent-%COMP%]{display:block}.algo[_ngcontent-%COMP%]{background:hsl(40,94%,74%);background:linear-gradient(90deg,#0e8388 0%,#cbe4de 100%);background:-webkit-linear-gradient(90deg,#0e8388 0%,#cbe4de 100%)}.container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.item[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;display:flex;justify-content:center;align-items:center;background-color:#e2e2e2;font-size:1.5rem}.element[_ngcontent-%COMP%]{position:relative;width:100%;border-radius:0;height:3px;display:flex;justify-content:center;align-items:center;background-color:#cfcdcd;flex-direction:column}.triangle[_ngcontent-%COMP%]{position:absolute;top:50%;right:0;width:0;height:0;border-top:10px solid transparent;border-bottom:10px solid transparent;border-left:10px solid #b9b8b8;transform:translateY(-50%)}.current-debt[_ngcontent-%COMP%]{font-size:1.4rem;margin-top:-8px}.old-debt[_ngcontent-%COMP%]{font-size:.8rem;text-decoration:line-through}.card[_ngcontent-%COMP%]{background-color:#fff;border-radius:16px;box-shadow:0 4px 16px #0003;display:flex;flex-direction:column;overflow:hidden;padding:16px}.card-title[_ngcontent-%COMP%]{color:#333;font-size:24px;margin:0 auto;text-align:center}.card-description[_ngcontent-%COMP%]{margin-top:1rem;font-size:1.2rem}"]}),o})();var f=_(4006);function q(o,r){if(1&o&&(e.TgZ(0,"option",11),e._uU(1),e.qZA()),2&o){const t=r.$implicit;e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function G(o,r){if(1&o&&(e.TgZ(0,"small"),e._uU(1),e.qZA()),2&o){const t=e.oxw(2).$implicit,n=e.oxw();let i;e.xp6(1),e.AsE(" ",n.calcExchange(null==n.myDebts||null==n.myDebts.debts||null==(i=n.myDebts.debts.get(t.id))?null:i.individualtotalIveBeenPaid)," ",n.currency.currencyExchangeSymbol," ")}}function U(o,r){if(1&o&&(e.TgZ(0,"small"),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit,n=e.oxw(3);e.xp6(1),e.AsE(" ",n.calcExchange(t.cost)," ",n.currency.currencyExchangeSymbol," ")}}function z(o,r){1&o&&(e.TgZ(0,"div",29),e.SDv(1,30),e.qZA())}function J(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"li",25),e.NdJ("dblclick",function(){const l=e.CHM(t).$implicit,s=e.oxw(3);return e.KtG(s.pay(l.id,s.userID,l.settleBy.includes(s.userID)))}),e.TgZ(1,"div",26),e._uU(2),e.qZA(),e.TgZ(3,"div",27),e._uU(4),e.YNc(5,U,2,2,"small",19),e.qZA(),e.YNc(6,z,2,0,"div",28),e.qZA()}if(2&o){const t=r.$implicit,n=e.oxw(3);e.xp6(1),e.ekj("textpaid",t.settleBy.includes(n.userID)),e.xp6(1),e.Oqu(t.title),e.xp6(1),e.ekj("textpaid",t.settleBy.includes(n.userID)),e.xp6(1),e.AsE(" ",t.cost,"",n.currency.currencySymbol," "),e.xp6(1),e.Q6J("ngIf",n.currency.active),e.xp6(1),e.Q6J("ngIf",t.settleBy.includes(n.userID))}}function Q(o,r){if(1&o&&(e.TgZ(0,"small"),e._uU(1),e.qZA()),2&o){const t=e.oxw(2).$implicit,n=e.oxw();let i,l;e.xp6(1),e.AsE(" ",n.calcExchange(null==(i=n.debts.get(t.id))||null==i.debts||null==(l=i.debts.get(n.userID))?null:l.individualtotalIveBeenPaid)," ",n.currency.currencyExchangeSymbol," ")}}function Y(o,r){if(1&o&&(e.TgZ(0,"small"),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit,n=e.oxw(3);e.xp6(1),e.AsE(" ",n.calcExchange(t.cost)," ",n.currency.currencyExchangeSymbol," ")}}function X(o,r){1&o&&(e.TgZ(0,"div",29),e.SDv(1,31),e.qZA())}function k(o,r){if(1&o){const t=e.EpF();e.TgZ(0,"li",25),e.NdJ("dblclick",function(){const l=e.CHM(t).$implicit,s=e.oxw(3);return e.KtG(s.pay(l.id,s.userID,l.settleBy.includes(s.userID)))}),e.TgZ(1,"div",26),e._uU(2),e.qZA(),e.TgZ(3,"div",27),e._uU(4),e.YNc(5,Y,2,2,"small",19),e.qZA(),e.YNc(6,X,2,0,"div",28),e.qZA()}if(2&o){const t=r.$implicit,n=e.oxw(3);e.xp6(1),e.ekj("textpaid",t.settleBy.includes(n.userID)),e.xp6(1),e.Oqu(t.title),e.xp6(1),e.ekj("textpaid",t.settleBy.includes(n.userID)),e.xp6(1),e.AsE(" ",t.cost,"",n.currency.currencySymbol," "),e.xp6(1),e.Q6J("ngIf",n.currency.active),e.xp6(1),e.Q6J("ngIf",t.settleBy.includes(n.userID))}}function j(o,r){if(1&o&&(e.TgZ(0,"small"),e._uU(1),e.qZA()),2&o){const t=e.oxw(2).$implicit,n=e.oxw();let i;e.xp6(1),e.AsE(" ",n.calcExchange(null==n.myDebts||null==n.myDebts.debts||null==(i=n.myDebts.debts.get(t.id))?null:i.newDebt)," ",n.currency.currencyExchangeSymbol," ")}}function V(o,r){if(1&o&&(e.TgZ(0,"div",13)(1,"div",14)(2,"div",15)(3,"div",16),e.SDv(4,17),e.qZA(),e.TgZ(5,"div",18),e._uU(6),e.YNc(7,G,2,2,"small",19),e.qZA()()(),e.TgZ(8,"ul",20),e.YNc(9,J,7,9,"li",21),e.qZA(),e.TgZ(10,"div",22)(11,"div",15)(12,"div",16),e.SDv(13,23),e.qZA(),e.TgZ(14,"div",18),e._uU(15),e.YNc(16,Q,2,2,"small",19),e.qZA()()(),e.TgZ(17,"ul",20),e.YNc(18,k,7,9,"li",21),e.qZA(),e.TgZ(19,"div",22)(20,"div",15)(21,"div",16),e.SDv(22,24),e.qZA(),e.TgZ(23,"div",18),e._uU(24),e.YNc(25,j,2,2,"small",19),e.qZA()()()()),2&o){const t=e.oxw().$implicit,n=e.oxw();let i,l,s,c,a,d,b;e.xp6(4),e.pQV(t.name),e.QtT(4),e.xp6(2),e.AsE(" ",null==n.myDebts||null==n.myDebts.debts||null==(i=n.myDebts.debts.get(t.id))?null:i.individualtotalIveBeenPaid," ",n.currency.currencySymbol," "),e.xp6(1),e.Q6J("ngIf",n.currency.active),e.xp6(2),e.Q6J("ngForOf",null==n.myDebts||null==n.myDebts.debts||null==(l=n.myDebts.debts.get(t.id))?null:l.RefDebtsIds),e.xp6(4),e.pQV(t.name),e.QtT(13),e.xp6(2),e.AsE(" ",null==(s=n.debts.get(t.id))||null==s.debts||null==(c=s.debts.get(n.userID))?null:c.individualtotalIveBeenPaid," ",n.currency.currencySymbol," "),e.xp6(1),e.Q6J("ngIf",n.currency.active),e.xp6(2),e.Q6J("ngForOf",null==(a=n.debts.get(t.id))||null==a.debts||null==(d=a.debts.get(n.userID))?null:d.RefDebtsIds),e.xp6(6),e.AsE(" ",null==n.myDebts||null==n.myDebts.debts||null==(b=n.myDebts.debts.get(t.id))?null:b.newDebt," ",n.currency.currencySymbol," "),e.xp6(1),e.Q6J("ngIf",n.currency.active)}}function H(o,r){if(1&o&&(e.ynx(0),e.YNc(1,V,26,13,"div",12),e.BQk()),2&o){const t=r.$implicit,n=e.oxw();e.xp6(1),e.Q6J("ngIf",t.id!=n.userID)}}const K=[{path:"",component:R},{path:":id",component:(()=>{class o{constructor(t,n,i,l,s){this.debtsService=t,this.userService=n,this.currencyService=i,this.expensesService=l,this.route=s,this.hideInfo=!1,this.users=this.userService.getUsers(),this.usersHTML=this.userService.getIterableUsers(),this.currency=this.currencyService.getCurrencySettings(),this.debts=this.debtsService.getDebts(),this.userID=this.route.snapshot.paramMap.get("id")||"0"}ngOnInit(){this.setDebts(),console.log(this.debts)}calcExchange(t){return this.currencyService.calcExchangeValue(t||0)}setDebts(){var t=this;return(0,u.Z)(function*(){const i=(yield(0,g.z)(t.users)).get(t.userID),l=t.debts.get(t.userID);i&&l&&(t.myDebts=l)})()}pay(t,n,i){var l=this;return(0,u.Z)(function*(){let s=yield(0,g.z)(l.expensesService.getExpenseByID(t));s?(i?s.settleBy.splice(s.settleBy.indexOf(n),1):s.settleBy.push(n),l.expensesService.editExpense(s),l.recalculateDebts()):console.error("error")})()}recalculateDebts(){this.debtsService.reset(),this.debts=this.debtsService.getDebts(),this.setDebts()}closeInfo(){this.hideInfo=!0}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(h),e.Y36(y.f),e.Y36(F.i),e.Y36(A.r),e.Y36(T.gz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-debts-detail"]],decls:16,vars:9,consts:function(){let r,t,n,i,l,s,c;return r="Deudas detalladas de ",t="" + "\ufffd#12\ufffd" + "Info!" + "\ufffd/#12\ufffd" + " Pulsa dos veces para marcar como pagado un gasto. " + "\ufffd#13\ufffd" + "" + "\ufffd/#13\ufffd" + "",n="Le debes a " + "\ufffd0\ufffd" + "",i="Te debe " + "\ufffd0\ufffd" + "",l="Total a pagar:",s="PAGADO",c="PAGADO",[[1,"mt-4","mb-8","container-fluid"],[1,"d-flex","flex-row","align-items-center"],[1,"me-2"],r,["name","name",1,"form-select","mb-2",3,"ngModel","ngModelChange","change"],["user",""],[3,"value",4,"ngFor","ngForOf"],["role","alert",1,"alert","alert-warning","alert-dismissible","fade","show"],t,["type","button","data-bs-dismiss","alert","aria-label","Close",1,"btn-close",3,"click"],[4,"ngFor","ngForOf"],[3,"value"],["class","card mt-3",4,"ngIf"],[1,"card","mt-3"],[1,"card-header"],[1,"row","fw-bold","align-items-center"],[1,"col-8"],n,[1,"col-4","text-end"],[4,"ngIf"],[1,"list-group","list-group-flush"],["class","list-group-item align-items-center list-group-item-action",3,"dblclick",4,"ngFor","ngForOf"],[1,"card-footer"],i,l,[1,"list-group-item","align-items-center","list-group-item-action",3,"dblclick"],[1,"col-9"],[1,"col-3","text-end"],["class","paid",4,"ngIf"],[1,"paid"],s,c]},template:function(t,n){1&t&&(e.TgZ(0,"section",0)(1,"div",1)(2,"div",2)(3,"h5"),e.SDv(4,3),e.qZA()(),e.TgZ(5,"div")(6,"select",4,5),e.NdJ("ngModelChange",function(l){return n.userID=l})("change",function(){return n.setDebts()}),e.YNc(8,q,2,2,"option",6),e.ALo(9,"async"),e.qZA()()(),e.TgZ(10,"div",7),e.tHW(11,8),e._UZ(12,"strong"),e.TgZ(13,"button",9),e.NdJ("click",function(){return n.closeInfo()}),e.qZA(),e.N_p(),e.qZA(),e.YNc(14,H,2,1,"ng-container",10),e.ALo(15,"async"),e.qZA()),2&t&&(e.xp6(6),e.Q6J("ngModel",n.userID),e.xp6(2),e.Q6J("ngForOf",e.lcZ(9,5,n.usersHTML)),e.xp6(2),e.ekj("hide",n.hideInfo),e.xp6(4),e.Q6J("ngForOf",e.lcZ(15,7,n.usersHTML)))},dependencies:[f.YN,f.Kr,f.EJ,f.JJ,f.On,p.sg,p.O5,p.Ov],styles:[".list-group-item[_ngcontent-%COMP%]{display:flex;border:1px solid rgba(0,0,0,.125)}small[_ngcontent-%COMP%]{font-size:xx-small;display:block}.paid[_ngcontent-%COMP%]{position:absolute;margin:0 auto;left:0;right:0;width:115px;letter-spacing:8px;font-weight:700;color:#e57b7b}.textpaid[_ngcontent-%COMP%]{opacity:.4;text-decoration:line-through}li[_ngcontent-%COMP%]{cursor:pointer}.oldDebt[_ngcontent-%COMP%]{display:inline-block;font-size:x-small}.hover[_ngcontent-%COMP%]{cursor:pointer;margin-left:1em}.done[_ngcontent-%COMP%]{text-decoration:line-through}.hide[_ngcontent-%COMP%]{display:none}"]}),o})()}];let W=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[T.Bz.forChild(K),T.Bz]}),o})(),ee=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[h],imports:[f.u5,p.ez,W]}),o})()},3428:(I,E,_)=>{_.d(E,{i:()=>e});var p=_(4650),T=_(3249);let e=(()=>{class u{constructor(g){this.storageService=g,this.currency=this.loadCurrencyFromLocalStorage()}loadCurrencyFromLocalStorage(){return this.storageService.getData().currency}saveCurrencyIntoLocalStorage(g){this.storageService.saveDataToLocalStorage(void 0,void 0,this.currency),this.currency=g}getCurrencySettings(){return this.currency}calcExchangeValue(g){return Math.round(100*(g*this.currency.exchangeValue+Number.EPSILON))/100}reset(){this.currency=this.loadCurrencyFromLocalStorage()}}return u.\u0275fac=function(g){return new(g||u)(p.LFG(T.g))},u.\u0275prov=p.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()}}]);